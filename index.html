<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goldfish Hub</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Mock lowdb-like local storage (using localStorage for simplicity)
    const db = {
      tasks: JSON.parse(localStorage.getItem('tasks')) || [],
      birthdays: JSON.parse(localStorage.getItem('birthdays')) || [],
      events: JSON.parse(localStorage.getItem('events')) || [],
      write: (key, data) => {
        localStorage.setItem(key, JSON.stringify(data));
      }
    };

    // Main App Component
    function App() {
      const [activeTab, setActiveTab] = useState('home');
      const [dbState, setDbState] = useState(db); // State to trigger re-renders

      // Save data to localStorage on changes
      useEffect(() => {
        db.write('tasks', db.tasks);
        db.write('birthdays', db.birthdays);
        db.write('events', db.events);
        setDbState({ ...db }); // Update state to trigger re-render
      }, [db.tasks, db.birthdays, db.events]);

      // Get today's reminders
      const getDailyReminders = () => {
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        const todayTime = today.getTime();
        const todayMMDD = `${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

        return {
          tasks: db.tasks.filter(task => {
            const dueDate = new Date(task.dueDate).getTime();
            return dueDate <= todayTime; // Include tasks on or before today
          }),
          birthdays: db.birthdays.filter(b => {
            const bMMDD = b.date.split('-').slice(1).join('-'); // Get MM-DD
            let bDate = new Date(b.date);
            const currentYear = today.getFullYear();
            bDate.setFullYear(currentYear); // Set to current year
            let bTime = bDate.getTime();
            // If birthday has passed this year, set to next year
            if (bTime < todayTime) {
              bDate.setFullYear(currentYear + 1);
              bTime = bDate.getTime();
            }
            const reminderStart = bTime - (b.reminderDays * 24 * 60 * 60 * 1000);
            return todayTime >= reminderStart && todayTime <= bTime;
          }),
          events: db.events.filter(e => {
            const eDate = new Date(e.date).getTime();
            const reminderStart = eDate - (e.reminderDays * 24 * 60 * 60 * 1000);
            return todayTime >= reminderStart && todayTime <= eDate;
          })
        };
      };

      const reminders = getDailyReminders();

      return (
        <div className="min-h-screen bg-gray-100 p-4">
          <h1 className="text-3xl font-bold text-center mb-4">Goldfish Hub</h1>
          
          {/* Tabs */}
          <div className="flex justify-center space-x-4 mb-6">
            <button
              className={`px-4 py-2 rounded ${activeTab === 'home' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('home')}
            >
              Home
            </button>
            <button
              className={`px-4 py-2 rounded ${activeTab === 'tasks' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('tasks')}
            >
              Tasks
            </button>
            <button
              className={`px-4 py-2 rounded ${activeTab === 'birthdays' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('birthdays')}
            >
              Birthdays
            </button>
            <button
              className={`px-4 py-2 rounded ${activeTab === 'events' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('events')}
            >
              Events
            </button>
          </div>

          {/* Tab Content */}
          {activeTab === 'home' && (
            <div className="max-w-2xl mx-auto">
              <h2 className="text-2xl font-semibold mb-4">Today's Reminders</h2>
              <div className="space-y-4">
                <div>
                  <h3 className="text-lg font-medium">Tasks</h3>
                  {reminders.tasks.length ? (
                    <ul className="list-disc pl-5">
                      {reminders.tasks.map((task, i) => (
                        <li key={i}>{task.title} - Due: {task.dueDate}</li>
                      ))}
                    </ul>
                  ) : (
                    <p>No tasks due or overdue.</p>
                  )}
                </div>
                <div>
                  <h3 className="text-lg font-medium">Birthdays</h3>
                  {reminders.birthdays.length ? (
                    <ul className="list-disc pl-5">
                      {reminders.birthdays.map((b, i) => (
                        <li key={i}>{b.name} - {b.date.split('-').slice(1).join('-')} (Reminder: {b.reminderDays} days)</li>
                      ))}
                    </ul>
                  ) : (
                    <p>No birthdays within reminder period.</p>
                  )}
                </div>
                <div>
                  <h3 className="text-lg font-medium">Recurring Events</h3>
                  {reminders.events.length ? (
                    <ul className="list-disc pl-5">
                      {reminders.events.map((e, i) => (
                        <li key={i}>{e.title} - {e.date} (Reminder: {e.reminderDays} days)</li>
                      ))}
                    </ul>
                  ) : (
                    <p>No events within reminder period.</p>
                  )}
                </div>
              </div>
            </div>
          )}

          {activeTab === 'tasks' && (
            <div className="max-w-2xl mx-auto">
              <h2 className="text-2xl font-semibold mb-4">Tasks</h2>
              <TaskManager setDbState={setDbState} />
            </div>
          )}

          {activeTab === 'birthdays' && (
            <div className="max-w-2xl mx-auto">
              <h2 className="text-2xl font-semibold mb-4">Birthdays</h2>
              <BirthdayManager setDbState={setDbState} />
            </div>
          )}

          {activeTab === 'events' && (
            <div className="max-w-2xl mx-auto">
              <h2 className="text-2xl font-semibold mb-4">Recurring Events</h2>
              <EventManager setDbState={setDbState} />
            </div>
          )}
        </div>
      );
    }

    // Task Manager Component
    function TaskManager({ setDbState }) {
      const [title, setTitle] = useState('');
      const [dueDate, setDueDate] = useState('');
      const [editIndex, setEditIndex] = useState(null);

      const addOrUpdateTask = () => {
        if (title && dueDate) {
          if (editIndex !== null) {
            db.tasks[editIndex] = { title, dueDate };
          } else {
            db.tasks.push({ title, dueDate });
          }
          db.write('tasks', db.tasks);
          setDbState({ ...db });
          setTitle('');
          setDueDate('');
          setEditIndex(null);
        }
      };

      const editTask = (index) => {
        setTitle(db.tasks[index].title);
        setDueDate(db.tasks[index].dueDate);
        setEditIndex(index);
      };

      const deleteTask = (index) => {
        db.tasks.splice(index, 1);
        db.write('tasks', db.tasks);
        setDbState({ ...db });
      };

      return (
        <div>
          <div className="flex space-x-2 mb-4">
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="Task title"
              className="border p-2 rounded flex-1"
            />
            <input
              type="date"
              value={dueDate}
              onChange={(e) => setDueDate(e.target.value)}
              className="border p-2 rounded"
            />
            <button onClick={addOrUpdateTask} className="bg-blue-500 text-white px-4 py-2 rounded">
              {editIndex !== null ? 'Update Task' : 'Add Task'}
            </button>
          </div>
          <ul className="list-disc pl-5 space-y-2">
            {db.tasks.map((task, i) => (
              <li key={i} className="flex justify-between items-center">
                <span>{task.title} - Due: {task.dueDate}</span>
                <div>
                  <button onClick={() => editTask(i)} className="text-blue-500 mr-2">Edit</button>
                  <button onClick={() => deleteTask(i)} className="text-red-500">Delete</button>
                </div>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    // Birthday Manager Component
    function BirthdayManager({ setDbState }) {
      const [name, setName] = useState('');
      const [date, setDate] = useState('');
      const [reminderDays, setReminderDays] = useState('30');
      const [editIndex, setEditIndex] = useState(null);

      const addOrUpdateBirthday = () => {
        if (name && date && reminderDays) {
          if (editIndex !== null) {
            db.birthdays[editIndex] = { name, date, reminderDays: parseInt(reminderDays) };
          } else {
            db.birthdays.push({ name, date, reminderDays: parseInt(reminderDays) });
          }
          db.write('birthdays', db.birthdays);
          setDbState({ ...db });
          setName('');
          setDate('');
          setReminderDays('30');
          setEditIndex(null);
        }
      };

      const editBirthday = (index) => {
        setName(db.birthdays[index].name);
        setDate(db.birthdays[index].date);
        setReminderDays(db.birthdays[index].reminderDays.toString());
        setEditIndex(index);
      };

      const deleteBirthday = (index) => {
        db.birthdays.splice(index, 1);
        db.write('birthdays', db.birthdays);
        setDbState({ ...db });
      };

      return (
        <div>
          <div className="flex space-x-2 mb-4">
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Name"
              className="border p-2 rounded flex-1"
            />
            <input
              type="date"
              value={date}
              onChange={(e) => setDate(e.target.value)}
              className="border p-2 rounded"
            />
            <input
              type="number"
              value={reminderDays}
              onChange={(e) => setReminderDays(e.target.value)}
              placeholder="Days before"
              className="border p-2 rounded w-24"
              min="0"
            />
            <button onClick={addOrUpdateBirthday} className="bg-blue-500 text-white px-4 py-2 rounded">
              {editIndex !== null ? 'Update Birthday' : 'Add Birthday'}
            </button>
          </div>
          <ul className="list-disc pl-5 space-y-2">
            {db.birthdays.map((b, i) => (
              <li key={i} className="flex justify-between items-center">
                <span>{b.name} - {b.date} (Reminder: {b.reminderDays} days)</span>
                <div>
                  <button onClick={() => editBirthday(i)} className="text-blue-500 mr-2">Edit</button>
                  <button onClick={() => deleteBirthday(i)} className="text-red-500">Delete</button>
                </div>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    // Event Manager Component
    function EventManager({ setDbState }) {
      const [title, setTitle] = useState('');
      const [date, setDate] = useState('');
      const [reminderDays, setReminderDays] = useState('7');
      const [editIndex, setEditIndex] = useState(null);

      const addOrUpdateEvent = () => {
        if (title && date && reminderDays) {
          if (editIndex !== null) {
            db.events[editIndex] = { title, date, reminderDays: parseInt(reminderDays) };
          } else {
            db.events.push({ title, date, reminderDays: parseInt(reminderDays) });
          }
          db.write('events', db.events);
          setDbState({ ...db });
          setTitle('');
          setDate('');
          setReminderDays('7');
          setEditIndex(null);
        }
      };

      const editEvent = (index) => {
        setTitle(db.events[index].title);
        setDate(db.events[index].date);
        setReminderDays(db.events[index].reminderDays.toString());
        setEditIndex(index);
      };

      const deleteEvent = (index) => {
        db.events.splice(index, 1);
        db.write('events', db.events);
        setDbState({ ...db });
      };

      return (
        <div>
          <div className="flex space-x-2 mb-4">
            <input
              type="text"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              placeholder="Event title"
              className="border p-2 rounded flex-1"
            />
            <input
              type="date"
              value={date}
              onChange={(e) => setDate(e.target.value)}
              className="border p-2 rounded"
            />
            <input
              type="number"
              value={reminderDays}
              onChange={(e) => setReminderDays(e.target.value)}
              placeholder="Days before"
              className="border p-2 rounded w-24"
              min="0"
            />
            <button onClick={addOrUpdateEvent} className="bg-blue-500 text-white px-4 py-2 rounded">
              {editIndex !== null ? 'Update Event' : 'Add Event'}
            </button>
          </div>
          <ul className="list-disc pl-5 space-y-2">
            {db.events.map((e, i) => (
              <li key={i} className="flex justify-between items-center">
                <span>{e.title} - {e.date} (Reminder: {e.reminderDays} days)</span>
                <div>
                  <button onClick={() => editEvent(i)} className="text-blue-500 mr-2">Edit</button>
                  <button onClick={() => deleteEvent(i)} className="text-red-500">Delete</button>
                </div>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    // Render App
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>